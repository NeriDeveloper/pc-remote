!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.PointerEventsPolyfill=b()}(this,function(){"use strict";function c(c,d){d=d||Object.create(null);var e=document.createEvent("Event");e.initEvent(c,d.bubbles||!1,d.cancelable||!1);for(var g,f=2;f<a.length;f++)g=a[f],e[g]=d[g]||b[f];e.buttons=d.buttons||0;var h=0;return h=d.pressure?d.pressure:e.buttons?.5:0,e.x=e.clientX,e.y=e.clientY,e.pointerId=d.pointerId||0,e.width=d.width||0,e.height=d.height||0,e.pressure=h,e.tiltX=d.tiltX||0,e.tiltY=d.tiltY||0,e.pointerType=d.pointerType||"",e.hwTimestamp=d.hwTimestamp||0,e.isPrimary=d.isPrimary||!1,e}function g(){this.array=[],this.size=0}function w(a,b,c,d){this.addCallback=a.bind(d),this.removeCallback=b.bind(d),this.changedCallback=c.bind(d),t&&(this.observer=new t(this.mutationWatcher.bind(this)))}function y(a){return"body /shadow-deep/ "+z(a)}function z(a){return'[touch-action="'+a+'"]'}function A(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; touch-action-delay: none; }"}function F(){if(D){B.forEach(function(a){String(a)===a?(C+=z(a)+A(a)+"\n",E&&(C+=y(a)+A(a)+"\n")):(C+=a.selectors.map(z)+A(a.rule)+"\n",E&&(C+=a.selectors.map(y)+A(a.rule)+"\n"))});var a=document.createElement("style");a.textContent=C,document.head.appendChild(a)}}function _(){if(!window.PointerEvent){if(window.PointerEvent=d,window.navigator.msPointerEnabled){var a=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:a,enumerable:!0}),n.registerSource("ms",$)}else n.registerSource("mouse",L),void 0!==window.ontouchstart&&n.registerSource("touch",W);n.register(document)}}function da(a){if(!n.pointermap.has(a))throw new Error("InvalidPointerId")}function ea(){window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:ba},releasePointerCapture:{value:ca}})}var a=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],b=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],d=c,e=window.Map&&window.Map.prototype.forEach,f=e?Map:g;g.prototype={set:function(a,b){return void 0===b?this.delete(a):(this.has(a)||this.size++,void(this.array[a]=b))},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.array.length=0,this.size=0},forEach:function(a,b){return this.array.forEach(function(c,d){a.call(b,c,d,this)},this)}};var h=f,i=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","buttons","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","type","target","currentTarget","which","pageX","pageY","timeStamp"],j=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],k={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},l="undefined"!=typeof SVGElementInstance,m={pointermap:new h,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,b){var c=b,d=c.events;d&&(d.forEach(function(a){c[a]&&(this.eventMap[a]=c[a].bind(c))},this),this.eventSources[a]=c,this.eventSourceList.push(c))},register:function(a){for(var d,b=this.eventSourceList.length,c=0;c<b&&(d=this.eventSourceList[c]);c++)d.register.call(d,a)},unregister:function(a){for(var d,b=this.eventSourceList.length,c=0;c<b&&(d=this.eventSourceList[c]);c++)d.unregister.call(d,a)},contains:function(a,b){try{return a.contains(b)}catch(a){return!1}},down:function(a){a.bubbles=!0,this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0,this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0,this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=!1,this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1,this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0,this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0,this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0,this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a),this.contains(a.target,a.relatedTarget)||this.leave(a)},enterOver:function(a){this.over(a),this.contains(a.target,a.relatedTarget)||this.enter(a)},eventHandler:function(a){if(!a._handledByPE){var b=a.type,c=this.eventMap&&this.eventMap[b];c&&c(a),a._handledByPE=!0}},listen:function(a,b){b.forEach(function(b){this.addEvent(a,b)},this)},unlisten:function(a,b){b.forEach(function(b){this.removeEvent(a,b)},this)},addEvent:function(a,b){a.addEventListener(b,this.boundHandler)},removeEvent:function(a,b){a.removeEventListener(b,this.boundHandler)},makeEvent:function(a,b){this.captureInfo[b.pointerId]&&(b.relatedTarget=null);var c=new d(a,b);return b.preventDefault&&(c.preventDefault=b.preventDefault),c._target=c._target||b.target,c},fireEvent:function(a,b){var c=this.makeEvent(a,b);return this.dispatchEvent(c)},cloneEvent:function(a){for(var c,b=Object.create(null),d=0;d<i.length;d++)c=i[d],b[c]=a[c]||j[d],!l||"target"!==c&&"relatedTarget"!==c||b[c]instanceof SVGElementInstance&&(b[c]=b[c].correspondingUseElement);return a.preventDefault&&(b.preventDefault=function(){a.preventDefault()}),b},getTarget:function(a){var b=this.captureInfo[a.pointerId];return b?a._target!==b&&a.type in k?void 0:b:a._target},setCapture:function(a,b){this.captureInfo[a]&&this.releaseCapture(a),this.captureInfo[a]=b;var c=document.createEvent("Event");c.initEvent("gotpointercapture",!0,!1),c.pointerId=a,this.implicitRelease=this.releaseCapture.bind(this,a),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease),c._target=b,this.asyncDispatchEvent(c)},releaseCapture:function(a){var b=this.captureInfo[a];if(b){var c=document.createEvent("Event");c.initEvent("lostpointercapture",!0,!1),c.pointerId=a,this.captureInfo[a]=void 0,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease),c._target=b,this.asyncDispatchEvent(c)}},dispatchEvent:function(a){var b=this.getTarget(a);if(b)return b.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,a))}};m.boundHandler=m.eventHandler.bind(m);var n=m,o={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&Boolean(a.elementFromPoint)},targetingShadow:function(a){var b=this.shadow(a);if(this.canTarget(b))return b},olderShadow:function(a){var b=a.olderShadowRoot;if(!b){var c=a.querySelector("shadow");c&&(b=c.olderShadowRoot)}return b},allShadows:function(a){for(var b=[],c=this.shadow(a);c;)b.push(c),c=this.olderShadow(c);return b},searchRoot:function(a,b,c){if(a){var e,f,d=a.elementFromPoint(b,c);for(f=this.targetingShadow(d);f;){if(e=f.elementFromPoint(b,c)){var g=this.targetingShadow(e);return this.searchRoot(g,b,c)||e}f=this.olderShadow(f)}return d}},owner:function(a){for(var b=a;b.parentNode;)b=b.parentNode;return b.nodeType!==Node.DOCUMENT_NODE&&b.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(b=document),b},findTarget:function(a){var b=a.clientX,c=a.clientY,d=this.owner(a.target);return d.elementFromPoint(b,c)||(d=document),this.searchRoot(d,b,c)}},p=Array.prototype.forEach.call.bind(Array.prototype.forEach),q=Array.prototype.map.call.bind(Array.prototype.map),r=Array.prototype.slice.call.bind(Array.prototype.slice),s=Array.prototype.filter.call.bind(Array.prototype.filter),t=window.MutationObserver||window.WebKitMutationObserver,u="[touch-action]",v={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};w.prototype={watchSubtree:function(a){this.observer&&o.canTarget(a)&&this.observer.observe(a,v)},enableOnSubtree:function(a){this.watchSubtree(a),a===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(a)},installNewSubtree:function(a){p(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll(u):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,b){this.changedCallback(a,b)},concatLists:function(a,b){return a.concat(r(b))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var b=q(a,this.findElements,this);return b.push(s(a,this.isElement)),b.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){if("childList"===a.type){var b=this.flattenMutationTree(a.addedNodes);b.forEach(this.addElement,this);var c=this.flattenMutationTree(a.removedNodes);c.forEach(this.removeElement,this)}else"attributes"===a.type&&this.elementChanged(a.target,a.oldValue)}};var x=w,B=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],C="",D=window.PointerEvent||window.MSPointerEvent,E=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,G=n.pointermap,H=25,I=[1,4,2,8,16],J=!1;try{J=1===new MouseEvent("test",{buttons:1}).buttons}catch(a){}var T,K={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){n.listen(a,this.events)},unregister:function(a){n.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){for(var g,b=this.lastTouches,c=a.clientX,d=a.clientY,e=0,f=b.length;e<f&&(g=b[e]);e++){var h=Math.abs(c-g.x),i=Math.abs(d-g.y);if(h<=H&&i<=H)return!0}},prepareEvent:function(a){var b=n.cloneEvent(a),c=b.preventDefault;return b.preventDefault=function(){a.preventDefault(),c()},b.pointerId=this.POINTER_ID,b.isPrimary=!0,b.pointerType=this.POINTER_TYPE,b},prepareButtonsForMove:function(a,b){var c=G.get(this.POINTER_ID);a.buttons=c?c.buttons:0,b.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=G.get(this.POINTER_ID),c=this.prepareEvent(a);J||(c.buttons=I[c.button],b&&(c.buttons|=b.buttons),a.buttons=c.buttons),G.set(this.POINTER_ID,a),b?n.move(c):n.down(c)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);J||this.prepareButtonsForMove(b,a),n.move(b)}},mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=G.get(this.POINTER_ID),c=this.prepareEvent(a);if(!J){var d=I[c.button];c.buttons=b?b.buttons&~d:0,a.buttons=c.buttons}G.set(this.POINTER_ID,a),0===c.buttons||c.buttons===I[c.button]?(this.cleanupMouse(),n.up(c)):n.move(c)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);J||this.prepareButtonsForMove(b,a),n.enterOver(b)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);J||this.prepareButtonsForMove(b,a),n.leaveOut(b)}},cancel:function(a){var b=this.prepareEvent(a);n.cancel(b),this.cleanupMouse()},cleanupMouse:function(){G.delete(this.POINTER_ID)}},L=K,M=n.captureInfo,N=o.findTarget.bind(o),O=o.allShadows.bind(o),P=n.pointermap,Q=2500,R=200,S="touch-action",U=!1,V={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){U?n.listen(a,this.events):T.enableOnSubtree(a)},unregister:function(a){U&&n.unlisten(a,this.events)},elementAdded:function(a){var b=a.getAttribute(S),c=this.touchActionToScrollType(b);c&&(a._scrollType=c,n.listen(a,this.events),O(a).forEach(function(a){a._scrollType=c,n.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0,n.unlisten(a,this.events),O(a).forEach(function(a){a._scrollType=void 0,n.unlisten(a,this.events)},this)},elementChanged:function(a,b){var c=a.getAttribute(S),d=this.touchActionToScrollType(c),e=this.touchActionToScrollType(b);d&&e?(a._scrollType=d,O(a).forEach(function(a){a._scrollType=d},this)):e?this.elementRemoved(a):d&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var b=a,c=this.scrollTypes;return"none"===b?"none":b===c.XSCROLLER?"X":b===c.YSCROLLER?"Y":c.SCROLLER.exec(b)?"XY":void 0},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){(0===P.size||1===P.size&&P.has(1))&&(this.firstTouch=a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount())},removePrimaryPointer:function(a){a.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(a,R)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var b=0;return"touchstart"!==a&&"touchmove"!==a||(b=1),b},touchToPointer:function(a){var b=this.currentTouchEvent,c=n.cloneEvent(a),d=c.pointerId=a.identifier+2;c.target=M[d]||N(c),c.bubbles=!0,c.cancelable=!0,c.detail=this.clickCount,c.button=0,c.buttons=this.typeToButtons(b.type),c.width=a.radiusX||a.webkitRadiusX||0,c.height=a.radiusY||a.webkitRadiusY||0,c.pressure=a.force||a.webkitForce||.5,c.isPrimary=this.isPrimaryTouch(a),c.pointerType=this.POINTER_TYPE;var e=this;return c.preventDefault=function(){e.scrolling=!1,e.firstXY=null,b.preventDefault()},c},processTouches:function(a,b){var c=a.changedTouches;this.currentTouchEvent=a;for(var e,d=0;d<c.length;d++)e=c[d],b.call(this,this.touchToPointer(e))},shouldScroll:function(a){if(this.firstXY){var b,c=a.currentTarget._scrollType;if("none"===c)b=!1;else if("XY"===c)b=!0;else{var d=a.changedTouches[0],e=c,f="Y"===c?"X":"Y",g=Math.abs(d["client"+e]-this.firstXY[e]),h=Math.abs(d["client"+f]-this.firstXY[f]);b=g>=h}return this.firstXY=null,b}},findTouch:function(a,b){for(var e,c=0,d=a.length;c<d&&(e=a[c]);c++)if(e.identifier===b)return!0},vacuumTouches:function(a){var b=a.touches;if(P.size>=b.length){var c=[];P.forEach(function(a,d){if(1!==d&&!this.findTouch(b,d-2)){var e=a.out;c.push(e)}},this),c.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a),this.setPrimaryTouch(a.changedTouches[0]),this.dedupSynthMouse(a),this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){P.set(a.pointerId,{target:a.target,out:a,outTarget:a.target}),n.over(a),n.enter(a),n.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var b=a,c=P.get(b.pointerId);if(c){var d=c.out,e=c.outTarget;n.move(b),d&&e!==b.target&&(d.relatedTarget=b.target,b.relatedTarget=e,d.target=e,b.target?(n.leaveOut(d),n.enterOver(b)):(b.target=e,b.relatedTarget=null,this.cancelOut(b))),c.out=b,c.outTarget=b.target}},touchend:function(a){this.dedupSynthMouse(a),this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||(n.up(a),n.out(a),n.leave(a)),this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){n.cancel(a),n.out(a),n.leave(a),this.cleanUpPointer(a)},cleanUpPointer:function(a){P.delete(a.pointerId),this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var b=L.lastTouches,c=a.changedTouches[0];if(this.isPrimaryTouch(c)){var d={x:c.clientX,y:c.clientY};b.push(d);var e=function(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)}.bind(null,b,d);setTimeout(e,Q)}}};U||(T=new x(V.elementAdded,V.elementRemoved,V.elementChanged,V));var ba,ca,W=V,X=n.pointermap,Y=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,Z={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(a){n.listen(a,this.events)},unregister:function(a){n.unlisten(a,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var b=a;return Y&&(b=n.cloneEvent(a),b.pointerType=this.POINTER_TYPES[a.pointerType]),b},cleanup:function(a){X.delete(a)},MSPointerDown:function(a){X.set(a.pointerId,a);var b=this.prepareEvent(a);n.down(b)},MSPointerMove:function(a){var b=this.prepareEvent(a);n.move(b)},MSPointerUp:function(a){var b=this.prepareEvent(a);n.up(b),this.cleanup(a.pointerId)},MSPointerOut:function(a){var b=this.prepareEvent(a);n.leaveOut(b)},MSPointerOver:function(a){var b=this.prepareEvent(a);n.enterOver(b)},MSPointerCancel:function(a){var b=this.prepareEvent(a);n.cancel(b),this.cleanup(a.pointerId)},MSLostPointerCapture:function(a){var b=n.makeEvent("lostpointercapture",a);n.dispatchEvent(b)},MSGotPointerCapture:function(a){var b=n.makeEvent("gotpointercapture",a);n.dispatchEvent(b)}},$=Z,aa=window.navigator;aa.msPointerEnabled?(ba=function(a){da(a),this.msSetPointerCapture(a)},ca=function(a){da(a),this.msReleasePointerCapture(a)}):(ba=function(b){da(b),n.setCapture(b,this)},ca=function(b){da(b),n.releaseCapture(b,this)}),F(),_(),ea();var fa={dispatcher:n,Installer:x,PointerEvent:d,PointerMap:h,targetFinding:o};return fa});
